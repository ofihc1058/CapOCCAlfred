//Generated by wsdl2apex

public class wwwParnetComMxCFDI {
	
	static testMethod void Mytest()
    {
    	String jsonEnvio='{"Payments":{"U_FechaPagoBancario":"","U_EstatusdePago":null,"U_ConceptodeCobro":null,"TransferReference":"0","ImportePago":"","DocEntry":"Folio-000094970","CardCode":"CL0111517","Banco":null},"Documents":{"U_TipoFacturacion":"5","U_TipoFactura":"0","U_ReferenciaCIE":"0000949701","U_Pagada":"0","U_Origen":"0","U_OrdenCompra2":null,"U_OrdenCompra":"","U_NumProveedor":null,"U_NombreEjecutivo":"Benjamin Zavala Floran","U_Leyenda":null,"U_InicioVigencia":"20140218","U_IdVentaCarrito":"","U_HoraCreacion":"10:49AM","U_FolioSalesForce":"Folio-000094970","U_FinVigencia":"20140318","U_EstatusFactura":"1","U_CuentaVirtual":"002180650341402994","U_CorreoAlterno":"efabela@occ.com.mx","U_ComentarioVig":"Vigencia del 20140218 al 20140318","U_ClasificacionFactura":"1","Series":"1","SalesPersonCode":"0031","DocumentLines":[{"UnitPrice":"599.00","Quantity":"10.00","ItemCode":"010100010M1","DiscountPercent":""}],"DocDueDate":"20140218","DocDate":"20140218","DocCurrency":"$","CardCode":"CL0111517"},"BusinessPartners":{"ZipCode":"86100","Website":"No tiene","VatLiable":"Y","U_UltimasVacantes":"","U_RecibirInfo":"","U_PrepAcademica":"","U_OtrosEstudios":"","U_OtrosConocimientos":"","U_NoInt":null,"U_IDSalesForce":"001W000000GPUDFIA5","U_IDSAE":null,"U_Idiomas":"","U_IDContactoSF":null,"U_HorarioContacto":"","U_Genero":"NS","U_FechaUltPost3":"","U_FechaUltPost2":"","U_FechaUltPost1":"","U_FechaContacto":"","U_EstatusCV":"ND","U_Edad":"","U_DesOfertaInt":"","U_CursoInteres":"","U_Comentarios":"","U_CodOfertaInt":"","U_AreasInteres":"","U_AreasExperiencia":"","Territory":"28","TaxCode":"IVAP16","StreetNo":null,"Street":"ADOLFO RUIZ CORTINEZ","State":"TAB","ShipToDefault":"FACTURAR A","SalesPersonCode":"0031","Remarks2":"","Remarks1":"","Position":null,"PlaceOfBirth":"","Phone2":null,"Phone1":null,"PayTermsGrpCode":"2","Pager":"","MobilePhone":null,"JsonName":null,"JsonCurrency":"##","GroupCode":"100","FederalTaxID":"TAU720127MD9","Fax":null,"E_Mail":null,"DateOfBirth":"","County":"Villahermosa","Country":"MX","ContactPerson":null,"CompanyPrivate":"C","City":"","CEPhone2":null,"CEPhone1":null,"Cellular":"","CEFax":null,"CardType":"C","CardName":"TABASCO AUTOMOVILISTICA SA DE CV","CardForeignName":"TABASCO AUTOMOVILISTICA SA DE CV","CardCode":"CL0111517","BPFederalTaxID":"","Block":"ATASTA","BilltoDefault":"FACTURAR A","AddressType":"S","AddressName":"FACTURAR A","Address":"","AdditionalID":"","actualizaSN":"False"}}';
    	//String endpoint = 'http://wscorp.occmcorp.com/Service.asmx'+'/ReceiverJSON';
    	String endpoint = 'http://aquariusp.occmcorp.com:1036/Service.asmx'+'/ReceiverJSON';
    	//String endpoint = 'http://sandboxcfdi.occmcorp.com/Service.asmx'+'/ReceiverJSON';
    	wwwParnetComMxCFDI.ServiceSoap service = new wwwParnetComMxCFDI.ServiceSoap();	
		service.AliveWS();
		service.ReceiverJSON(null);
		service.ReceiverJSON(jsonenvio);
		service.invokeWSPOST(jsonEnvio, endpoint);
		service.invokeWSPOST('ObjJSON=' + jsonEnvio, endpoint);
    }
	
	public static String ERROR = '-1';
	public class ServiceSoap {
        //public String endpoint_x = 'http://wscorp.occmcorp.com/Service.asmx';
        public String endpoint_x = 'http://aquariusp.occmcorp.com:1036/Service.asmx';
        //public String endpoint_x = 'http://sandboxcfdi.occmcorp.com/Service.asmx';
        public Map<String,String> inputHttpHeaders_x;
        public Map<String,String> outputHttpHeaders_x;
        public String clientCertName_x;
        public String clientCert_x;
        public String clientCertPasswd_x;
        public Integer timeout_x;
        private String[] ns_map_type_info = new String[]{'http://www.parnet.com.mx/', 'wwwParnetComMx'};
        
        public String AliveWS (){
        		wwwParnetComMx.TestClases test = new wwwParnetComMx.TestClases();
        		test.assembleDataXML();
        	  String response = 'Modified Field';
			   try {
			        String xml = invokeWSPOST('',this.endpoint_x +'/Alive');
			        XMLDom  xmlDom = new XMLDom(xml);
			        XMLDom.Element aliveElement = xmlDOM.getElementByTagName('alive');
			        if(aliveElement!=null){
						response = aliveElement.getAttribute('Fecha');
					}
				} catch(System.CalloutException e) {
					response =  e.getMessage();
				}	
			  return response;	
        }
        
        public String invokeWSPOST(String body,String endpoint){
        	try{
        	  String response = '';
        	  HttpRequest req = new HttpRequest(); 
			  req.setMethod('POST');
			  req.setEndpoint(endpoint); //Post
			  req.setBody(body); //Post
			  system.debug('RequestDebug:' + req.toString());
			  system.debug('RequestBody:' + req.getBody());
			  Http http = new Http(); 
			  HTTPResponse res = http.send(req);	 
			  response = res.getBody();
			  return response;
        	}
        	catch(Exception e){
        		String exep='Exepcion InvokeWSPost error, causa: ' + e.getCause() + ' Linea:' +  e.getLineNumber() + ' Mensaje:' + e.getMessage() + ' Stack Trace: ' + e.getStackTraceString() + '.';
				system.debug('Mensaje Exepcion:' + exep);
				return Utils.assembleXMLError( e.getMessage());
				//return Utils.assembleXMLError(exep);
			}
        
        }
         public String ReceiverJSON(String jsonEnvio){
          	String response = '';
          	encode(response);
          	system.Debug('ReceiverJSONAntesEncode:' + jsonEnvio);
          	jsonEnvio=encode(jsonEnvio);
          	String body= 'ObjJSON=' + jsonEnvio;
          	system.Debug('ReceiverJSON:' + body);
          		try {
			        String xml =   invokeWSPOST(body,this.endpoint_x +'/ReceiverJSON');
			       	response = xml; 
			       	system.Debug('XML' + xml);
				} catch(System.CalloutException e) {
					String exep='Exepcion InvokeWSPost error, causa: ' + e.getCause() + ' Linea:' +  e.getLineNumber() + ' Mensaje:' + e.getMessage() + ' Stack Trace: ' + e.getStackTraceString() + '.';
					system.debug('Mensaje Exepcion:' + exep);
					response =Utils.assembleXMLError( e.getMessage());
				}	
          	return response;	
         }
        private String encode(String cadena){
        	if(cadena==null){
        		return '';
        	}
        	return EncodingUtil.urlEncode(cadena, 'UTF-8');
        }
    }
}